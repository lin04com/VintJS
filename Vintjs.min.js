(function(a){"use strict";var b=this,c=b.VintJS||{},d=c.isType=function(a,b){return Object.prototype.toString.call(a).slice(8,-1).toLowerCase()===b.toLowerCase()},e=Array.prototype.forEach,f=c.forEach=function(a,b,c){if(null!=a)if(e&&a.forEach===e)a.forEach(b,c);else if(a.length===+a.length)for(var d=0;d<a.length;d++)b.call(c,a[d],d,a);else for(var f in a)a.hasOwnProperty(f)&&b.call(c,a[f],f,a)},g=Object.keys,h=c.getKeys=g||function(a){if(a!==Object(a))throw new TypeError("Invalid object");var b=[];return f(a,function(a,c){b.push(c)},this),b},i=c.extend=function(a){return f(Array.prototype.slice.call(arguments,1),function(b){if(b)for(var c in b)a[c]=b[c]}),a},j=[],k=c.__getTempArray=function(){return j.length=0,f(arguments,function(a,b){j[b]=a},this),j};c.console=b.console||function(){for(var b={},c=["assert","clear","constructor","count","debug","dir","dirxml","error","group","groupCollapsed","groupEnd","info","log","markTimeline","profile","profileEnd","table","time","timeEnd","timeStamp","trace","warn"],d=0;d<c.length;d++)b[c[d]]=a.noop;return b}(),c.has=function(a,b){return a.hasOwnProperty(b)},c.restObj=function(a){for(var b in a)delete a[b]};var l={hash_prefix:"",getCurrentUser:function(){return!0},template_url:"/static/template/",login_url:"/login"};c.setTimeout=function(a,c,d){return d=d||b,setTimeout(function(){a.call(d)},c)},c.setInterval=function(a,c,d){return d=d||b,setInterval(function(){a.call(d)},c)},c.getConfig=function(a){return arguments.length?l[a]:l},c.create=function(b){return f(b,function(a,b){l[b]=a}),l.hash_spliter=new RegExp("#"+c.getConfig("hash_prefix")+"(.*)$"),c.$init=a("#vint-init"),this.template.get("base",function(a){c.$init.html(a),this.location.listen()},this),this},c.Debug=function(){l.debug=!0};var m=/\s+/,n=function(a,b,c,e){if(!c)return!0;if(d(c,"object"))return f(c,function(c,d){a[b].apply(a,k(d,c).concat(e))},this),!1;if(m.test(c)){var g=c.split(m);return f(g,function(c){a[b].apply(a,k(c).concat(e))},this),!1}return!0},o=c.Event={on:function(a,b,c){if(!n(this,"on",a,[b,c])||!b)return this;this.__events||(this.__events={});var d=this.__events[a]||(this.__events[a]=[]);return d.push({callback:b,context:c,ctx:c||this}),this},off:function(a,b,c){if(!this.__events||!n(this,"off",a,[b,c]))return this;if(0===arguments.length)return this.__events={},this;var e,g,i;return d(a,"RegExp")?(e=[],f(h(this.__events),function(b){a.test(b)&&e.push(b)})):e=a?[a]:h(this.__events),f(e,function(a){(g=this.__events[a])&&(this.__events[a]=i=[],(b||c)&&f(g,function(a){(b&&b!==a.callback||c&&c!==a.context)&&i.push(a)}),i.length?this.__events[a]=i:delete this.__events[a])},this),this},trigger:function(a){if(!this.__events)return this;var b=Array.prototype.slice.call(arguments,1);if(!n(this,"trigger",a,b))return this;var c=this.__events[a];return f(c,function(a){a.callback.apply(a.ctx,b)},this),this}};i(c,o),window.VintJS=c}).call(window,jQuery),VintJS.location={__path_spliter:/^([^\?#]*)?(\?([^#]*))?$/,__current_location:{root:-1===window.location.href.indexOf("#")?window.location.href:window.location.href.substr(0,window.location.href.indexOf("#")),path:"",search:{}},__encodeUriQuery:function(a,b){return encodeURIComponent(a).replace(/%40/gi,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,b?"%20":"+")},__tryDecodeURIComponent:function(a){try{return decodeURIComponent(a)}catch(b){return a}},__pre_url:null,__pre_path:null,url:function(a,b){var c=window.location;return arguments.length?a===this.__pre_url?this:b?(c.replace(a),this):(c.href=a,this):c.href},__getResultUrl:function(){var a=VintJS.__getTempArray();return VintJS.forEach(this.__current_location.search,function(b,c){a.push(this.__encodeUriQuery(c,!0)+(b===!0?"":"="+this.__encodeUriQuery(b,!0)))},this),this.__current_location.root+"#"+VintJS.getConfig("hash_prefix")+this.__current_location.path+(a.length?"?"+a.join("&"):"")},path:function(a){return a?(this.__current_location.path="/"==a.charAt(0)?a:"/"+a,this.url(this.__getResultUrl()),this):this.__current_location.path},replace:function(a){return a?(this.__current_location.path="/"==a.charAt(0)?a:"/"+a,this.url(this.__getResultUrl(),!0),this):this},__checkUrl:function(){var a=window.location.href;if(a===this.__pre_url)return this;this.__pre_url=a;var b=location.href.match(VintJS.getConfig("hash_spliter")),c=b?b[1]:"";if(!c)return this.replace("/"),this;var d=this.__path_spliter.exec(c);if(d[3]){var e,f;VintJS.forEach(d[3].split("&"),function(a){a&&(e=a.split("="),(f=this.__tryDecodeURIComponent(e[0]))&&(this.__current_location.search[f]=e[1]?this.__tryDecodeURIComponent(e[1]):!0))},this)}else VintJS.restObj(this.__current_location.search);return d[1]&&this.__pre_url!==d[1]&&(this.__current_location.path=this.__tryDecodeURIComponent(d[1]),this.__pre_url=d[1]),this.trigger("urlChange"),this},search:function(a,b){if(1===arguments.length){if(VintJS.isType(a,"string"))return this.__current_location.search[a];VintJS.isType(a,"object")&&(this.__current_location.search=a)}return 2===arguments.length&&(null===b?delete this.__current_location.search[a]:this.__current_location.search[a]=b),this.url(this.__getResultUrl()),this},listen:function(){var a=this;VintJS.setTimeout(this.__checkUrl,0,this);var b=document.documentMode,c=/msie [\w.]+/.exec(navigator.userAgent.toLowerCase())&&(!b||7>=b);return!c&&"onhashchange"in window?$(window).on("hashchange",function(){a.__checkUrl()}):VintJS.setInterval(a.__checkUrl,50,this),this}},VintJS.extend(VintJS.location,VintJS.Event),VintJS.route={__routers:[],__route_init:!1,__otherwise:null,__name_spliter:/\s+/,__pre_treat_role:function(){var a=VintJS.__getTempArray.apply(this,this.__routers);this.__routers.length=0,VintJS.forEach(a,function(a){VintJS.isType(a.role,"regExp")||(a.role=new RegExp("^"+a.role.replace(/:number/g,"(\\d+)").replace(/:string/g,"(\\w+)").replace(/:all/g,"(.+)")+"$")),this.__routers.push(a)},this)},__use:function(a,b){return VintJS.isType(a,"function")?(a.apply(this,b),this):VintJS.isType(a,"object")?a.login_required&&!VintJS.getConfig("getCurrentUser").call(this)?("/"!=VintJS.location.path()&&VintJS.location.search("redirect",VintJS.location.path()),this.redirectTo(VintJS.getConfig("login_url"),!0),this):a.redirect_to?(this.redirectTo(a.redirect_to),this):(this.render(a.template,a.controller,b),this):this},render:function(a,b,c){return console.log(c),this},redirectTo:function(a,b){return b?VintJS.location.replace(a):VintJS.location.path(a),this},when:function(a,b){return this.__routers.push({role:a,router_object:b}),this},resources:function(a){if(this.__name_spliter.test(a))return this.resources(a.split(this.__name_spliter));if(VintJS.isType("array"))return VintJS.forEach(a,function(a){this.resources(a)},this),this;var b=a[0].toUpperCase()+a.substring(1),c=a+"s";return this.when("/"+c,{template:a+"/list",controller:b+"ListCtrl"}),this.when("/"+c+"/add",{template:a+"/add",controller:b+"AddCtrl"}),this.when("/"+c+"/:number",{template:a+"/get",controller:b+"GetCtrl"}),this.when("/"+c+"/edit/:number",{template:a+"/edit",controller:b+"EditCtrl"}),this},otherwise:function(a){return this.__otherwise=a,this},response:function(){this.__route_init||(this.__pre_treat_role(),this.__route_init=!0);for(var a=VintJS.location.path(),b=0;b<this.__routers.length;b++){var c=this.__routers[b],d=c.role.exec(a);if(null!==d)return d.shift(),this.__use(c.router_object,d),this}return this.__otherwise&&this.__use(this.__otherwise),this}},VintJS.location.on("urlChange",VintJS.route.response,VintJS.route),VintJS.template={__cache_sign:"T_",__cache:function(){if(!window.localStorage)return!1;for(var a=window.localStorage,b=0;b<a.length;b++){var c=a.key(b);0===c.indexOf("T_")&&a.removeItem(c)}return a}()||{},__set:function(a,b){this.__cache[a]=b},__load:function(a,b){var c=this;$.get(a,function(a){b.call(c,a)})},get:function(a,b,c){b=b||$.noop,c=c||this;var d=this.__cache_sign+a;if(void 0!==this.__cache[d])return b(this.__cache[d]),this;var e=this;return this.__load(VintJS.getConfig("template_url")+a+".html",function(a){e.__set(d,a),b.call(c,a)}),this}};